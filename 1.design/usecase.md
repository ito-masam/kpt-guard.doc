# ユースケース

- 前提として、@replyを利用する側をユーザとする
- 前提として、botがメンバーとして参加しているチャンネルからのみレポートを受け付ける
	- メッセージを受け付ける毎にfromのチャンネルに自身が含まれているか確認することで、インターネットにフルオープンでも情報を取り出すことができない

## レポートを登録する

1. slackのbotとして動作する
1. botは@replyでコマンドとレポートを受け付ける
1. 受け付けるコマンドは`post <レポート>`
1. botは受け付けたレポートを、誰(who)から・どんな内容(content)での２つに分解する
1. 改善状態をproblem固定とする
1. 保存する先はDB

```
@incident post Aプロジェクトでパスワードの長さが英数４桁だった。少なくとも英数記号以上にしなければ暗号強度が低すぎて辞書攻撃で破られてしまう。
```

## レポートを修正する

1. slackのbotとして動作する
1. botは@replyでコマンドとレポートIDとレポートを受け付ける
1. 受け付けるコマンドは`post #<レポートID> <レポート>`
1. botは受け付けたレポートIDに紐つくレポートを、誰から・どんな内容での２つに分解する
	- 代替コース：受け付けたレポートIDに紐つくレポートが存在しない場合は、`404 Not Found`を返して終わる。
1. 履歴は保存しない
1. 改善状態を変更しない

```
@incident #0104503 Bプロジェクトでパスワードの長さが英数４桁だった。少なくとも英数記号以上にしなければ暗号強度が低すぎて辞書攻撃で破られてしまう。
```

## レポートを削除する

1. slackのbotとして動作する
1. botは@replyでコマンドとレポートIDを受け付ける
1. 受け付けるコマンドは`delete #<レポートID>`
1. botは受け付けたレポートIDに紐つくレポートを論理削除する
	- 代替コース：受け付けたレポートIDに紐つくレポートが存在しない場合は、`404 Not Found`を返して終わる。
1. 履歴は保存しない
1. 改善状態を変更しない

```
@incident delete #0104503
```

## レポートリストを出力する

1. slackのbotとして動作する
1. botは@replyでコマンドを受け付ける
1. 受け付けるコマンドは`list`
1. botは登録済みのレポートを一覧出力する
	- 代替コース：登録済みレポートが存在しない場合は、`404 Not Found`を返して終わる。
1. 一覧の列は、改善状態・レポート・登録日時・レポートID
1. 一覧には論理削除したレポートを含めない

```
@incident list

* keep Aプロジェクトでパスワードの長さが英数４桁だった。少なくとも英数記号以上にしなければ暗号強度が低すぎて辞書攻撃で破られてしまう。 (2017-01-16 17:30:04 #0104503)
* problem Aプロジェクトでパスワードの長さが英数４桁だった。少なくとも英数記号以上にしなければ暗号強度が低すぎて辞書攻撃で破られてしまう。 (2017-01-16 17:30:04 #0104503)
* try Aプロジェクトでパスワードの長さが英数４桁だった。少なくとも英数記号以上にしなければ暗号強度が低すぎて辞書攻撃で破られてしまう。 (2017-01-16 17:30:04 #0104503)
```

## レポートの改善状態を変更する

1. slackのbotとして動作する
1. botは@replyでコマンドとレポートIDと改善状態を受け付ける
1. 受け付けるコマンドは`post #<レポートID> :<改善状態(keep, try)>`
1. botは受け付けたレポートIDに紐つくレポートの改善状態を変更する
	- 代替コース：受け付けたレポートIDに紐つくレポートが存在しない場合は、`404 Not Found`を返して終わる。
1. 改善状態は、`problem --> try <--> keep`の順にしか遷移できない
	- 代替コース：受け付けた改善状態が遷移順に違反する場合は、`400 Bad Request`を返して終わる。
	- 代替コース：受け付けた改善状態が`keep, try`以外の場合は、`400 Bad Request`を返して終わる。

```
@incident post #0104503 :try
```
